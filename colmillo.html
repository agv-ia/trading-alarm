<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colmillo - El Juego</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>*{user-select:none;}</style>
</head>
<body class="bg-gradient-to-b from-green-200 via-lime-200 to-cyan-200 flex items-center justify-center min-h-screen overflow-hidden">
  <div class="flex flex-col items-center">
    <div id="game" class="relative w-[90vw] max-w-md h-[80vh] bg-white border-4 border-gray-700 rounded-2xl shadow-lg overflow-hidden">
      <div id="score" class="absolute top-2 left-2 z-10 text-xl font-bold bg-yellow-300 text-black px-4 py-1 rounded shadow">
        Puntos: 0
      </div>
      <img id="colmillo" src="https://static.thenounproject.com/png/1368935-512.png"
           class="absolute bottom-2 left-1/2 transform -translate-x-1/2 w-16 h-16 rounded-full border-2 border-black"
           alt="Colmillo el Zorrino" onerror="onImageError('zorrino')" />
    </div>
    <p class="mt-4 text-center text-lg text-gray-700">
      Usa las flechas para mover a Colmillo 🦨 y atrapa los caracoles 🐌
    </p>
  </div>

  <audio id="catchSound" src="https://cdn.jsdelivr.net/gh/CodeExplainedRepo/Sound-Files/catch.mp3" preload="auto" onerror="onAudioError()"></audio>

<script>
  const game = document.getElementById('game'),
        colmillo = document.getElementById('colmillo'),
        scoreDisplay = document.getElementById('score'),
        catchSound = document.getElementById('catchSound');

  let colmilloX = game.clientWidth / 2 - colmillo.offsetWidth / 2;
  let keys = {}, score = 0, gameTimer, moveTimer;

  document.addEventListener('keydown', e => keys[e.key] = true);
  document.addEventListener('keyup', e => keys[e.key] = false);

  function moveColmillo(){
    const speed = 6, maxX = game.clientWidth - colmillo.offsetWidth;
    if (keys['ArrowLeft']) colmilloX = Math.max(0, colmilloX - speed);
    if (keys['ArrowRight']) colmilloX = Math.min(maxX, colmilloX + speed);
    colmillo.style.left = colmilloX + 'px';
  }

  moveTimer = setInterval(moveColmillo, 20);

  function createSnail(){
    const snail = document.createElement('img');
    snail.src = "https://static.thenounproject.com/png/2503738-512.png";
    snail.className = 'absolute w-12 h-12';
    snail.alt = 'Caracol';
    snail.onerror = () => onImageError('caracol');
    snail.style.left = `${Math.random() * (game.clientWidth - 48)}px`;
    snail.style.top = '0px';
    game.appendChild(snail);
    fall(snail);
  }

  function fall(snail){
    let top = 0;
    const timer = setInterval(() => {
      top += 2; snail.style.top = top + 'px';
      collisionCheck(snail, timer);
    }, 20);
  }

  function collisionCheck(snail, timer){
    try {
      const sr = snail.getBoundingClientRect(), cr = colmillo.getBoundingClientRect();
      if (sr.bottom > cr.top && sr.top < cr.bottom && sr.left < cr.right && sr.right > cr.left) {
        clearInterval(timer); snail.remove();
        playCatchSound();
        incrementScore();
      } else if (sr.top > game.getBoundingClientRect().bottom) {
        clearInterval(timer); snail.remove();
      }
    } catch(e) {
      console.error('Error colisión:', e);
    }
  }

  function playCatchSound(){
    catchSound.currentTime = 0;
    catchSound.play().catch(err => console.warn('Error al reproducir sonido:', err));
  }

  function incrementScore(){
    score++;
    scoreDisplay.textContent = `Puntos: ${score}`;
    if (score >= 100) endGame();
  }

  function startGame(){
    colmillo.style.left = colmilloX + 'px';
    try {
      gameTimer = setInterval(createSnail, 800);
    } catch(e) {
      alert('No se pudo iniciar el juego.');
      console.error(e);
    }
  }

  function endGame(){
    clearInterval(gameTimer); clearInterval(moveTimer);
    alert('🎉 ¡Colmillo atrapó 100 caracoles! 🎉');
    location.reload();
  }

  function onImageError(tipo){
    alert(`Error al cargar imagen del ${tipo}. Comprueba que estás en línea.`);
    console.warn(`Falló cargar imagen: ${tipo}`);
  }

  function onAudioError(){
    alert('Error al cargar el sonido. Comprueba tu conexión o permisos de audio.');
    console.warn('Audio no pudo cargarse.');
  }

  window.addEventListener('load', startGame);
</script>
</body>
</html>



